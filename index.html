<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cerminan Guts</title>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Source Sans Pro', sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background-color: #22282d;
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 30px 15px;
    }
    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-slide {
      animation: fadeSlide 0.6s ease both;
    }
    em.fade-slide {
      display: block;
      animation: fadeSlide 0.6s ease both;
    }
    .container {
      max-width: 650px;
      width: 100%;
      background-color: rgba(85, 102, 120, 0.6);
      backdrop-filter: blur(1.5px);
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      text-align: center;
      animation: fadeSlide 0.6s ease both;
    }
    h1 {
      font-size: 40px;
      font-weight: 700;
      color: white;
      margin-bottom: 20px;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-bottom: 25px;
    }
    .button {
      padding: 8px 14px;
      font-size: 14px;
      font-weight: 600;
      background-color: #40bcf4;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.25s ease;
      height: 38px;
      min-width: 140px;
    }
    .button:hover {
      background-color: #00e054;
      transform: scale(1.03);
    }
    #question {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
      color: white;
    }
    textarea {
      width: 90%;
      max-width: 500px;
      padding: 12px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
      min-height: 75px;
      max-height: 150px;
      margin: 10px auto 20px;
      display: block;
      background-color: rgba(255, 255, 255, 0.5);
    }

    textarea::placeholder {
      color: black; /* putih lembut */
    }

    p {
      font-size: 16px;
      margin-bottom: 12px;
      color: #DCDCDC;
    }
    em {
      font-size: 16px;
      color: #DCDCDC;
    }
  </style>
</head>
<body>
  <div class="container fade-slide">
    <h1 class="fade-slide"><strong>Cerminan Guts</strong></h1>
    <div class="button-group fade-slide">
      <button class="button" onclick="window.location.href='about.html'">üìñ Tentang</button>
      <button class="button" onclick="toggleMusic()" id="musicBtn">üéµ Musik</button>
      <button class="button" onclick="saveReflection()" id="saveBtn">üíæ Simpan Refleksi</button>
      <button class="button" onclick="showHistory()">üìú Cek Riwayat</button>
      <button class="button" onclick="showGallery()">üåÖ Galeri Refleksi</button>
    </div>

    <p class="fade-slide">
      Selamat datang di <strong>Cerminan Guts</strong>. Jawablah pertanyaan di bawah ini dengan jujur. Terbukalah kepada dirimu sendiri. Gunakan ini sebagai kompas moral pribadimu di era digital.
      <a href="#" onclick="location.reload()" style="color: #EEC463; text-decoration: underline;">Refresh</a> halaman untuk pertanyaan baru. <em>"Jawablah seakan ini momen paling jujur dalam hidupmu."</em>
    </p>

    <p id="question" class="fade-slide"></p>
    <textarea id="answer" placeholder="Tulis refleksimu di sini..." class="fade-slide" style="color: black;"></textarea>

    <p class="fade-slide" style="color: white;"><strong>Di tengah segala hal yang terjadi, apa yang paling kamu harapkan dari hari esok?</strong></p>
    <textarea id="hope" placeholder="Tulis harapanmu di sini..." class="fade-slide" style="color: black;"></textarea>
    <div class="fade-slide" style="
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 4px auto 12px;
      max-width: 500px;
    ">
      <input type="checkbox" id="publicCheckbox" style="margin-right: 10px;" />
      <label for="publicCheckbox" style="color: #DCDCDC; font-size: 14px;">
        Izinkan tampil di <strong>Galeri Refleksi</strong> (tanpa identitas)
      </label>
    </div>

    <em class="fade-slide">‚ö†Ô∏è <strong>Privasi Terjaga:</strong> Jawabanmu disimpan anonim. Hanya ditampilkan di Galeri Refleksi jika kamu mengizinkan.</em>

    <p class="fade-slide" style="margin-top: 8px;">
      Dibuat oleh <a href="https://linktr.ee/bynguts" target="_blank" style="color: #EEC643; text-decoration: underline;">@bibinanshori</a>
    </p>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ‚è≥ 1. Konfigurasi Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDG_CJhx-NzuNtnbLs7kVCXXqnDCGBjrx8",
      authDomain: "cerminan-guts.firebaseapp.com",
      projectId: "cerminan-guts",
      storageBucket: "cerminan-guts.firebasestorage.app",
      messagingSenderId: "1027822835789",
      appId: "1:1027822835789:web:a76ed4aa1776b485d16404",
      measurementId: "G-5ZCDL13NRF"
    };

    firebase.initializeApp(firebaseConfig);
    const firestore = firebase.firestore();

    // ‚è≥ 2. IndexedDB untuk lokal
    const request = indexedDB.open("refleksiDB", 1);
    let db;
    let dbReady = false;

    request.onupgradeneeded = function (event) {
      db = event.target.result;
      if (!db.objectStoreNames.contains("refleksi")) {
        db.createObjectStore("refleksi", { keyPath: "id", autoIncrement: true });
      }
    };

    request.onsuccess = function (event) {
      db = event.target.result;
      dbReady = true;
    };

    request.onerror = function () {
      alert("Gagal membuka database lokal.");
    };

    // ‚è≥ 3. Daftar pertanyaan
    const questions = [/* pertanyaan panjangmu di sini (TETAP) */
    "Apa arti integritas bagimu di media sosial?",
    "Kapan terakhir kamu berkata jujur meski merugikan dirimu?",
    "Pernahkah kamu memilih tanggung jawab padahal bisa saja lari darinya?",
    "Bagaimana kamu tunjukkan nasionalisme secara online?",
    "Apa bentuk kepedulianmu terhadap lingkungan digital?",
    "Apa tindakan kecil yang menunjukkan cinta tanah air hari ini?",
    "Kapan kamu berdiri untuk keadilan tanpa dukungan?"
    ];
    const questionEl = document.getElementById("question");
    const answerEl = document.getElementById("answer");
    const hopeEl = document.getElementById("hope");
    const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
    questionEl.innerHTML = `<strong>${randomQuestion}</strong>`;

    // ‚è≥ 4. Fungsi Simpan
    function saveReflection() {
      const answer = answerEl.value.trim();
      const hope = hopeEl.value.trim();
      const isChecked = document.getElementById("publicCheckbox").checked;

      const reflection = {
        question: questionEl.textContent,
        answer,
        hope,
        isPublic: false,         // Belum langsung ditampilkan
        isPending: isChecked,    // Masuk ke admin jika dicentang
        time: firebase.firestore.Timestamp.now()
      };

      // Simpan ke Firebase
      firestore.collection("refleksi").add(reflection)
        .then(() => {
          alert("Refleksi berhasil disimpan.");
          answerEl.value = "";
          hopeEl.value = "";
          document.getElementById("publicCheckbox").checked = false;
        })
        .catch((error) => {
          alert("Gagal menyimpan ke Firebase: " + error.message);
        });

      // Simpan ke IndexedDB
      if (dbReady && db) {
        const tx = db.transaction("refleksi", "readwrite");
        const store = tx.objectStore("refleksi");
        store.add(reflection);
      }
    }

    function showHistory() {
      window.location.href = "riwayat.html";
    }

    function showGallery() {
      window.location.href = "galeri.html";
    }

    // ‚è≥ 5. Musik
    let music;
    let isPlaying = false;

    function toggleMusic() {
      const musicBtn = document.getElementById("musicBtn");

      if (!music) {
        music = new Audio("clair-de-lune-suite-bergamasque-l-75-3rd-movement-claude-debussy-448s-11942.mp3");
        music.loop = true;
      }

      if (!isPlaying) {
        music.play();
        isPlaying = true;
        musicBtn.textContent = "üîä Musik Hidup";
      } else {
        music.pause();
        isPlaying = false;
        musicBtn.textContent = "üîá Musik Mati";
      }
    }
  </script>
</body>
</html>
